---
- name: Ensure Network Security Group Exists
  azure_rm_securitygroup:
    name: "{{ az_network_security_group_name }}"
    resource_group: "{{ az_resource_group_name }}"
    rules:
      - name: "{{ item[1].Name }}"
        protocol: "{{ item[1].protocol }}"
        destination_port_range: "{{ item[1].destination_port_range }}"
        access: "{{ item[1].access }}"
        priority: "{{ item[1].priority }}"
        direction: "{{ item[1].direction }}"
    state: "present"
    tenant: "{{ azure_tenant_id }}"
    subscription_id: "{{ azure_subscription_id }}"
    client_id: "{{ azure_client_id }}"
    secret: "{{ azure_client_secret }}"
    tags:
      Owner: "{{ item[0].Owner }}"
      Company: "{{ item[0].Company }}"
      Project: "{{ item[0].Project }}"
  with_nested:
    - "{{ azure_tags }}"
    - "{{ az_network_security_group_rules }}"
  register: CreatedNetworkSecurityGroup
...
